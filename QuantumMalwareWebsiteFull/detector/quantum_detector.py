from pathlib import Path
from joblib import load
import numpy as np

class QuantumMalwareDetector:
    """OOP wrapper for the trained ML model saved as quantum_model.pkl"""

    def __init__(self, model_path=None):
        base = Path(__file__).resolve().parent
        default = base / 'ml' / 'quantum_model.pkl'
        self.model_path = Path(model_path) if model_path else default
        if not self.model_path.exists():
            raise FileNotFoundError(f"Model not found at {self.model_path}")
        self._load()

    def _load(self):
        self.model = load(self.model_path)

    def predict(self, X):
        X = np.asarray(X)
        if X.ndim == 1:
            X = X.reshape(1, -1)
        return self.model.predict(X)

    def predict_proba(self, X):
        X = np.asarray(X)
        if X.ndim == 1:
            X = X.reshape(1, -1)
        if hasattr(self.model, 'predict_proba'):
            return self.model.predict_proba(X)
        raise AttributeError("Underlying model has no predict_proba")
